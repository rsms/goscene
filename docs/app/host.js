((g,h)=>{let i=function(){return this}(),e={},f=(c,d)=>{if(typeof c==="number"){let a=e[c],b;return a||(a=e[c]={exports:{}},g[c].call(i,f,a.exports,a)),b=a.exports,d&&(!b||!b.__esModule)&&((!b||typeof b!=="object")&&(b={}),"default"in b||Object.defineProperty(b,"default",{get:()=>a.exports,enumerable:!0})),b}Object.defineProperty(c,"__esModule",{value:!0});for(let a in d)Object.defineProperty(c,a,{get:d[a],enumerable:!0})};return f(h)})({0(){const t=console.log.bind(console);function p(b,a){}function na(b){return b<<16>>16}function oa(b){return b&65535}function pa(b){return b>>0}function i(b){return b>>>0}const J=i(2),K=i(3),L=i(10),M=i(11),N=i(12),O=i(13),P=i(14),Q=i(1000),R=i(1001),S=i(1002),T=i(1003),U=i(1004),V=i(1005),W=i(1006),X=i(1007),Y=i(1008),Z=i(1009),_=i(1010),$=i(1011),aa=i(1012),ba=i(1013),ca=i(1014),da=i(1015),ea=i(1016),fa=i(1017),ga=i(1018),qa=0,A=1<<0,B=1<<1,C=1<<2,D=1<<3,y=1<<4;function E(b){let a=[];return b&A&&a.push("EVWindowResize"),b&B&&a.push("EVPointerMove"),b&C&&a.push("EVPointerDown"),b&D&&a.push("EVPointerUp"),b&y&&a.push("EVAnimationFrame"),a.join("|")}const x={};function j(b,a,e){let f=x[b];f||(x[b]=f=[]),p(!f[a],`duplicate hostcall handler ${b}[${a}]`),f[a]=e}j("u32_",J,(b,a)=>{u.eventSubscribe(a)}),j("u32_",K,(b,a)=>{u.eventUnsubscribe(a)}),j("_f64",M,()=>window.devicePixelRatio||1),j("_f64",N,()=>performance.now()*1000);const ha=Date.now()-performance.now();j("_f64",O,()=>(ha+performance.now())*1000),j("_u32x2",L,()=>[window.innerWidth,window.innerHeight]),j("vu8_i32",P,(b,a,e)=>{let f=new Uint8Array(b.buf,e,a);return crypto.getRandomValues(f).length}),j("vi32_i32",123,(b,a,e)=>{t("hostcall",{argaddr:e,argc:a});for(let f=e+a*4;e<f;e+=4)t(`  val#${a-(f-e)/4}`,b.getInt32(e))}),j("j_u32x2",Q,(b,a)=>[a.drawingBufferWidth,a.drawingBufferHeight]),j("j_u32x2",R,(b,a)=>[a.canvas.clientWidth,a.canvas.clientHeight]),j("jvi32_",S,(b,a,e,f)=>{p(e==4);let c=b.getInt32(f),d=b.getInt32(f+4),g=b.getInt32(f+8),h=b.getInt32(f+12);a.viewport(c,d,g,h)}),j("ju32j_",Y,(b,a,e,f)=>{a.bindBuffer(e,f)}),j("ju32_",T,(b,a,e)=>{a.clear(e)}),j("ju32_",W,(b,a,e)=>{a.enable(e)}),j("ju32_",X,(b,a,e)=>{a.depthFunc(e)}),j("jvf32_",U,(b,a,e,f)=>{p(e==4);let c=b.getFloat32(f),d=b.getFloat32(f+4),g=b.getFloat32(f+8),h=b.getFloat32(f+12);a.clearColor(c,d,g,h)}),j("jf32_",V,(b,a,e)=>{a.clearDepth(e)}),j("jvu32_",Z,(b,a,e,f)=>{p(e==4);const c=b.getUint32(f),d=b.getUint32(f+4),g=b.getUint32(f+8),h=b.getUint32(f+12);a.bufferData(c,new Uint8Array(b.buf,g,h),d)}),j("jvu32_",_,(b,a,e,f)=>{p(e==6);const c=b.getUint32(f),d=b.getUint32(f+4),g=b.getUint32(f+8),h=b.getUint32(f+12),k=b.getUint32(f+16),l=b.getUint32(f+20);a.vertexAttribPointer(c,d,g,h,k,l)}),j("ju32x3_",ga,(b,a,e,f,c)=>{a.drawArrays(e,f,c)});for(let[b,a]of[[2,ba],[3,ca],[4,da]]){const e=WebGLRenderingContext.prototype[`uniformMatrix${b}fv`],f=b*b;j("jx2vu32_",a,(c,d,g,h,k)=>{p(h==2);const l=c.getUint32(k),o=c.getUint32(k+4),s=new Float32Array(c.buf,o,f);e.call(d,g,l,s)})}j("jx2vf32_",ea,(b,a,e,f,c)=>{if(f==1)a.uniform1f(e,b.getFloat32(c));else{const d=new Float32Array(b.buf,c,f);if(f==2)a.uniform2fv(e,d);else if(f==3)a.uniform3fv(e,d);else if(f==4)a.uniform4fv(e,d);else throw new Error(`invalid value count ${f}`)}}),j("jx2vi32_",fa,(b,a,e,f,c)=>{if(f==1)a.uniform1i(e,b.getInt32(c));else{const d=new Int32Array(b.buf,c,f);if(f==2)a.uniform2iv(e,d);else if(f==3)a.uniform3iv(e,d);else if(f==4)a.uniform4iv(e,d);else throw new Error(`invalid value count ${f}`)}}),j("ju32_",$,(b,a,e)=>{a.enableVertexAttribArray(e)}),j("jx2_",aa,(b,a,e)=>{a.useProgram(e)});class ia{constructor(b){this.go=b,this.buf=null,this.view=null,this.version=0}check(){let b=this.go._inst.exports.mem.buffer;return this.buf!==b&&(this.buf=b,this.view=new DataView(b),this.version++),this}getInt8(b){return this.view.getInt8(b,!0)}getUint8(b){return this.view.getUint8(b,!0)}getInt16(b){return this.view.getInt16(b,!0)}getUint16(b){return this.view.getUint16(b,!0)}getInt32(b){return this.view.getInt32(b,!0)}getUint32(b){return this.view.getUint32(b,!0)}getFloat32(b){return this.view.getFloat32(b,!0)}getFloat64(b){return this.view.getFloat64(b,!0)}getBigInt64(b){return this.view.getBigInt64(b,!0)}getBigUint64(b){return this.view.getBigUint64(b,!0)}setInt8(b,a){return this.view.setInt8(b,a,!0)}setUint8(b,a){return this.view.setUint8(b,a,!0)}setInt16(b,a){return this.view.setInt16(b,a,!0)}setUint16(b,a){return this.view.setUint16(b,a,!0)}setInt32(b,a){return this.view.setInt32(b,a,!0)}setUint32(b,a){return this.view.setUint32(b,a,!0)}setFloat32(b,a){return this.view.setFloat32(b,a,!0)}setFloat64(b,a){return this.view.setFloat64(b,a,!0)}setBigInt64(b,a){return this.view.setBigInt64(b,a,!0)}setBigUint64(b,a){return this.view.setBigUint64(b,a,!0)}getInt64(b){const a=this.view.getUint32(b+0,!0),e=this.view.getInt32(b+4,!0);return a+e*4.294967296e+09}setInt64(b,a){this.view.setUint32(b+0,a,!0),this.view.setUint32(b+4,Math.floor(a/4.294967296e+09),!0)}getUint8Slice(b){const a=this.getInt64(b),e=this.getInt64(b+8);return new Uint8Array(this.buf,a,e)}getInt32Slice(b){const a=this.getInt64(b),e=this.getInt64(b+8);return new Int32Array(this.buf,a,e)}getJSObject(b){const a=this.getUint32(b);return this.go._values[a]}}const u=new class b{constructor(){this.copyBuffer=new ArrayBuffer(4096),this.copyBufferU8=new Uint8Array(this.copyBuffer),this.copyBufferF32=new Float32Array(this.copyBuffer),this.eventMsgBuf=new ArrayBuffer(4096),this.eventMsgView=new DataView(this.eventMsgBuf),this.wasmInstance=null,this.eventSubMask=0,this.eventQueueMask=0,this.eventData=new Map(),this.persistentEvents=new Map(),this.persistentEventsVersion=0,this.persistentEventMask=0,this.runloopTickFunc=null;let a=this.go=new Go(),e=new ia(a);this.gomem=e;function f(c,d){Array.isArray(c)||(c=[c]);for(let g of c){const h=x[g];p(h,`no hostcallHandlers[sig=${g}]`),delete x[g],a.importObject.go["main.hostcall_"+g]=k=>{const l=e.check(),o=l.getInt32(k+8),s=h[o];if(!s)throw new Error(`invalid hostcall_${g} #${o}`);k+=16,d(l,k,s)}}}f("_f64",(c,d,g)=>{c.setFloat64(d,g(c))}),f("_u32x2",(c,d,g)=>{const h=g(c);c.setUint32(d,h[0]),c.setUint32(d+4,h[1])}),f(["vu8_i32","vi32_i32"],(c,d,g)=>{const h=c.getInt64(d),k=c.getInt64(d+8),l=g(c,k,h);c.setInt32(d+24,l)}),f("j_u32x2",(c,d,g)=>{const h=c.getJSObject(d),k=g(c,h);c.setUint32(d+8,k[0]),c.setUint32(d+12,k[1])}),f(["jvi32_","jvu32_","jvf32_"],(c,d,g)=>{const h=c.getJSObject(d),k=c.getInt64(d+8),l=c.getInt64(d+16);g(c,h,l,k)}),f("ju32x3_",(c,d,g)=>{const h=c.getJSObject(d),k=c.getUint32(d+8),l=c.getUint32(d+12),o=c.getUint32(d+16);g(c,h,k,l,o)}),f(["jx2vi32_","jx2vu32_","jx2vf32_"],(c,d,g)=>{const h=c.getJSObject(d),k=c.getJSObject(d+8),l=c.getInt64(d+16),o=c.getInt64(d+24);g(c,h,k,o,l)}),f("ju32_",(c,d,g)=>{g(c,c.getJSObject(d),c.getUint32(d+8))}),f("jf32_",(c,d,g)=>{g(c,c.getJSObject(d),c.getFloat32(d+8))}),f("ju32j_",(c,d,g)=>{g(c,c.getJSObject(d),c.getUint32(d+8),c.getJSObject(d+16))}),f("jx2_",(c,d,g)=>{g(c,c.getJSObject(d),c.getJSObject(d+8))}),f("u32_",(c,d,g)=>{g(c,c.getUint32(d-4))});if(!1)for(let c in x);this.initEvents()}log(){console.log.apply(console,arguments)}error(a){console.error(typeof a=="object"&&a.stack?a.stack:String(a))}get windowWidth(){return window.innerWidth}get windowHeight(){return window.innerHeight}get onWindowResize(){return null}set onWindowResize(a){window.addEventListener("resize",a)}get onPointerMove(){return null}set onPointerMove(a){window.addEventListener("pointermove",a)}get pixelScale(){return window.devicePixelRatio||1}monotime(){return performance.now()}getContext(a,e){return a.getContext(e)}main(a){return this.wasmInstance=a,this.go.run(a)}initEvents(){const a=this,e=(c,d,g)=>({ev:0,_jsevent:!0,handler:g,enable(){c.addEventListener(d,this.handler)},disable(){c.removeEventListener(d,this.handler)}}),f=(c,d)=>({ev:c,enable(){a.enablePersistentEvent(c,d)},disable(){a.disablePersistentEvent(c)}});a.events={[B]:e(window,"pointermove",c=>[c.x,c.y]),[C]:e(window,"pointerdown",c=>[c.x,c.y]),[D]:e(window,"pointerup",c=>[c.x,c.y]),[A]:e(window,"resize",c=>[window.innerWidth,window.innerHeight]),[y]:f(y)};for(let c in a.events){let d=a.events[c],g=d.ev=parseInt(c);if(d._jsevent){let h=d.handler;d.handler=k=>{a.eventEnqueue(g,h(k))}}}}eventSubscribe(a){t("host.eventSubscribe",a,E(a));for(let e in this.events){let f=this.events[e];a&f.ev&&(this.eventSubMask&f.ev)==0&&f.enable()}this.eventSubMask|=a}eventUnsubscribe(a){t("host.eventUnsubscribe",a,E(a));for(let e of this.events)a&e.ev&&this.eventSubMask&e.ev&&(e.disable(),this.eventData.delete(e.ev));this.eventQueueMask|=~a,this.eventSubMask|=~a}eventEnqueue(a,e){p(!e||e instanceof Array),this.eventQueueMask|=a,this.eventData.set(a,e),this.runloopWake&&this.runloopWakeA()}enablePersistentEvent(a,e){this.persistentEventMask|=a,this.eventQueueMask|=a,this.persistentEvents.set(a,e),this.persistentEventsVersion++,this.runloopWake&&this.runloopWake()}disablePersistentEvent(a){this.persistentEventMask|=~a,this.eventQueueMask|=a,this.persistentEvents.delete(a),this.persistentEventsVersion++}stopRunLoop(){t("Host.stopRunLoop"),this.runloopTickFunc=null}startRunLoop(a,e,f){t("Host.startRunLoop");if(this.runloopTickFunc)throw new Error("runloop already running");const c=performance.now();let d=e;const g=d;d+=4;const h=d;d+=4;const k=d;d+=4;const l=d;let o=0,s=0;const G=m=>{let n=l;for(let[w,q]of this.persistentEvents)n=H(m,n,w,q);o=this.persistentEvents.size,s=n},H=(m,n,w,q)=>{m.setUint32(n,w),n+=4,m.setUint32(n,q?q.length:0),n+=4;if(q)for(let ja of q)m.setUint32(n,ja),n+=4;return n};let I=0,z=0;var v=()=>{if(this.runloopTickFunc!==v)return;let m=this.gomem.check();m.version!=I?(G(m),I=m.version,z=this.persistentEventsVersion):this.persistentEventsVersion!=z&&(z=this.persistentEventsVersion,G(m)),m.setFloat32(g,(performance.now()-c)/1000),m.setUint32(h,this.eventQueueMask),m.setUint32(k,o+this.eventData.size);if(this.eventData.size>0){let n=s;for(let[w,q]of this.eventData)n=H(m,n,w,q);this.eventQueueMask=this.eventQueueMask&this.persistentEventMask,this.eventData.clear()}this.runloopWake=null,a(),this.eventQueueMask!=0?requestAnimationFrame(v):this.runloopWake=v};this.runloopWakeA=()=>{this.runloopWake=null,requestAnimationFrame(v)},this.runloopTickFunc=v,v()}}(),r=window._appinit;let F=0;r.host=u,r.initCallback=()=>{const b=(performance.now()-F).toFixed(1);console.debug(`wasm initialized in ${b}ms`),delete window._appinit,r.onLoaded&&r.onLoaded()},console.debug(`host boot ${Date.now()-r.time}ms`),(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(r.wasmFetch,u.go.importObject):r.wasmFetch.then(b=>b.arrayBuffer()).then(b=>WebAssembly.instantiate(b,u.go.importObject))).then(b=>{F=performance.now(),u.main(b.instance)});
}},0);
//# sourceMappingURL=host.js.map
